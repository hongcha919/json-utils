"use strict";function e(e){const t=JSON.stringify(e);return JSON.parse(t)}function t(e){let t=!1;return void 0!==e&&(t=!0),t}Object.defineProperty(exports,"__esModule",{value:!0});const r={type:"object",format:"event",title:"事件",isRequired:!1,readOnly:!1,properties:{type:{type:"string",default:"emit",format:"typeSelect",enum:["on","emit"],enumextra:["on","emit"],title:"事件类型",isRequired:!1,readOnly:!1},trigger:{type:"string",format:"input",default:"eventName",title:"触发事件",description:"用于输入触发事件的名称",placeholder:"请输入触发事件的名称",isRequired:!1,readOnly:!1},eventData:{type:"string",title:"事件数据",format:"json",default:"{}",description:"传递给触发事件的数据对象",isRequired:!1,readOnly:!1}},required:["type","trigger","eventData"],propertyOrder:["type","trigger","eventData"]},i={type:"object",format:"datasource",title:"数据源",readOnly:!1,properties:{type:{type:"string",default:"local",format:"typeSelect",enum:["local","remote"],enumextra:["local","remote"],title:"数据源类型"},data:{type:"string",title:"本地json数据",placeholder:"请输入静态json数据",format:"json",default:"{}",description:"用于设置本地的静态json数据",isRequired:!0},filter:{type:"string",title:"过滤器",format:"codearea",default:"() => {}",description:"用于定义过滤当前数据的函数",isRequired:!0}},required:["type","data","filter"],propertyOrder:["type","data","filter"]},a={type:"local",config:{dataName:"",body:{},filter:"return data;"},data:"{}",localFilter:"return data;"},o={jsonschema:{type:"object",title:"jsonSchemaObject",properties:{func:{type:"object",format:"func",title:"功能设置",readOnly:!0,properties:{a:{type:"string",title:"单文本框",format:"input",default:"",description:"",placeholder:"",isRequired:!1,readOnly:!1}},required:["a"],propertyOrder:["a"]},style:{type:"object",format:"style",title:"样式设置",readOnly:!0,properties:{b:{type:"string",title:"单文本框",format:"input",default:"",description:"",placeholder:"",isRequired:!1,readOnly:!1}},required:["b"],propertyOrder:["b"]},data:{type:"object",format:"data",title:"数据设置",readOnly:!0,properties:{c:{type:"string",title:"单文本框",format:"input",default:"",description:"",placeholder:"",isRequired:!1,readOnly:!1}},required:["c"],propertyOrder:["c"]}},required:["func","style","data"],propertyOrder:["func","style","data"]},input:{type:"string",title:"单文本框",format:"input",default:"",description:"",placeholder:"",isRequired:!1,readOnly:!1},boolean:{type:"boolean",title:"布尔值",format:"boolean",default:!1,description:"",isRequired:!1,readOnly:!1},object:{type:"object",format:"object",title:"对象类型",description:"",isRequired:!1,readOnly:!1,properties:{a:{type:"string",title:"单文本框",format:"input",default:"",description:"",placeholder:"",isRequired:!1,readOnly:!1}},required:["a"],propertyOrder:["a"]},array:{type:"array",format:"array",title:"数组",description:"",isRequired:!1,readOnly:!1,items:{type:"object",format:"object",title:"数组项",description:"",isRequired:!1,readOnly:!1,properties:{name:{type:"string",format:"input",title:"名字",default:"",description:"",placeholder:"",isRequired:!1,readOnly:!1}},required:["name"],propertyOrder:["name"]}},"empty-array":{type:"array",format:"array",title:"数组",description:"",items:{type:"object",format:"object",title:"数组项",description:"",properties:{}}},"empty-object":{type:"object",format:"object",title:"对象类型",description:"",properties:{}},url:{type:"string",title:"URL",format:"url",default:"",description:"",placeholder:"",isRequired:!1,readOnly:!1},textarea:{type:"string",title:"多行文本框",format:"textarea",default:"",description:"",placeholder:"",isRequired:!1,readOnly:!1},color:{type:"string",title:"颜色值",format:"color",default:"#ffffff",description:"",isRequired:!1,readOnly:!1},img:{type:"string",title:"IMG",format:"image",default:"",description:"点击上传图片",imgWidth:200,imgHeight:200,imgRatio:1,imgRatioReadOnly:!1,isRequired:!1,readOnly:!1},number:{type:"number",title:"数值",format:"number",default:1,minimum:0,maximum:1e3,description:"",isRequired:!1,readOnly:!1},json:{type:"string",title:"json数据项",format:"json",default:"{}",description:"",isRequired:!1,readOnly:!1},codearea:{type:"string",title:"函数类型",format:"codearea",placeholder:"请输入函数方法",default:'function func() { console.log("hello, world!"); }',description:"用于定义函数方法",isRequired:!1,readOnly:!1},htmlarea:{type:"string",title:"富文本类型",format:"htmlarea",placeholder:"请输入html代码片段",default:"<p>hello,world!</p>",description:"用于放置html代码片段",isRequired:!1,readOnly:!1},date:{type:"string",title:"日期",format:"date",default:"",description:"",placeholder:"",isRequired:!1,readOnly:!1},"date-time":{type:"string",title:"日期",format:"date-time",default:"",description:"",placeholder:"",isRequired:!1,readOnly:!1},time:{type:"string",title:"时间",format:"time",default:"",description:"",placeholder:"",isRequired:!1,readOnly:!1},quantity:{type:"object",format:"quantity",title:"单位计量输入",isRequired:!1,readOnly:!1,properties:{unit:{type:"number",title:"单位数值",format:"number",default:50,minimum:0,maximum:1e3,description:"",isRequired:!1,readOnly:!1},quantity:{type:"string",format:"typeSelect",default:"px",enum:["px","rem","em","%"],enumextra:["px","rem","em","%"],title:"单位类型",isRequired:!1,readOnly:!1}},required:["unit","quantity"],propertyOrder:["unit","quantity"]},radio:{type:"string",title:"单选",format:"radio",items:{type:"string",enum:["a","b","c"],enumextra:["选项a","选项b","选项c"]},description:"",isRequired:!1,readOnly:!1},select:{type:"array",title:"多选",format:"select",items:{type:"string",enum:["a","b","c"],enumextra:["选项a","选项b","选项c"]},description:"",isRequired:!1,readOnly:!1},"dynamic-data":{type:"object",format:"dynamic-data",title:"动态数据",readOnly:!1,properties:{type:{type:"string",default:"local",format:"typeSelect",enum:["local","remote"],enumextra:["本地数据","接口数据"],title:"数据类型"},config:{type:"object",title:"接口配置",format:"object",description:"用于存放接口的配置数据(url、请求参数等)",isRequired:!0,properties:{dataName:{type:"string",default:"local",format:"typeSelect",enum:["local","remote"],enumextra:["本地数据","接口数据"],title:"数据类型"},body:{type:"object",title:"请求参数配置",format:"object",description:"用于配置当前接口的请求参数数值",isRequired:!0},filter:{type:"string",title:"过滤器函数体",format:"codearea",default:"return data;",description:"用于定义过滤接口数据",isRequired:!0}},required:["dataName","body","filter"],propertyOrder:["dataName","body","filter"]},data:{type:"string",title:"数据内容",format:"json",default:"{}",description:"用于存放DynamicData的数据内容",isRequired:!0},localFilter:{type:"string",title:"过滤器",format:"codearea",default:"return data;",description:"用于定义过滤本地数据",isRequired:!0}},required:["type","config","data","localFilter"],propertyOrder:["type","config","data","localFilter"]},datasource:i,event:r},n={on:{type:"object",format:"event",title:"事件",isRequired:!1,readOnly:!1,properties:{type:{type:"string",default:"on",format:"typeSelect",enum:["on","emit"],enumextra:["on","emit"],title:"事件类型",isRequired:!1,readOnly:!1},register:{type:"string",format:"input",default:"eventName",title:"注册事件",description:"用于输入注册事件的名称",placeholder:"请输入注册事件的名称",isRequired:!1,readOnly:!1},actionFunc:{type:"string",title:"执行函数",format:"codearea",default:"() => {}",description:"",isRequired:!1,readOnly:!1}},required:["type","register","actionFunc"],propertyOrder:["type","register","actionFunc"]},emit:r},p={local:i,remote:{type:"object",format:"datasource",title:"数据源",readOnly:!1,properties:{type:{type:"string",default:"remote",format:"typeSelect",enum:["local","remote"],enumextra:["local","remote"],title:"数据源类型"},data:{type:"string",title:"远程json数据",placeholder:"请输入远程json数据源地址",format:"url",default:"http://xxx",isRequired:!0,description:"用于设置获取元素数据的请求地址"},filter:{type:"string",title:"过滤器",format:"codearea",default:"() => {}",description:"用于定义过滤当前数据的函数",isRequired:!0}},required:["type","data","filter"],propertyOrder:["type","data","filter"]}};function s(e){return/^http[s]?:\/\/.*/.test(e)}function l(e){return"String"===Object.prototype.toString.call(e).slice(8,-1)}function d(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function u(e){return"Boolean"===Object.prototype.toString.call(e).slice(8,-1)}function c(e){return/^\d{4}-\d{2}-\d{2}$/.test(e)}function f(e){return/^\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}$/.test(e)||/^\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}$/.test(e)}function y(e){return/^\d{2}:\d{2}:\d{2}$/.test(e)||/^\d{2}:\d{2}$/.test(e)}function m(e){let t=!1;return"Array"===Object.prototype.toString.call(e).slice(8,-1)&&(t=!0),t}function g(e){if(!m(e))return!1;for(let t=0,r=e.length;t<r;t++){if(!l(e[t]))return!1}return!0}function O(e){let t=!1;return"Object"===Object.prototype.toString.call(e).slice(8,-1)&&(t=!0),t}function b(e){let t=!1;return o.quantity.properties.quantity.enum.indexOf(e)>=0&&(t=!0),t}function x(e){return/^#[0-9a-f]{6}$/.test(e)||/^#[0-9a-f]{3}$/.test(e)}function j(e){let t=!1;return"Function"===Object.prototype.toString.call(e).slice(8,-1)&&(t=!0),t}function h(t){let r={};return r=t&&O(t)?function(t){let r;if(O(t)){const i=Object.keys(t);t.data&&t.filter&&2===i.length?r=m(t.data)||O(t.data)?e(p.local):e(p.remote):t.trigger&&t.eventData&&2===i.length?r=e(n.emit):t.register&&t.actionFunc&&2===i.length?r=e(n.on):t.quantity&&b(t.quantity)&&2===i.length?r=e(o.quantity):(r=e(o["empty-object"]),Object.keys(t).map(e=>{const i=t[e];r.properties[e]=h(i)}))}return r}(t):t&&m(t)?function(t){let r;if(t&&m(t))if(g(t)){r=e(o.select),r.items.enum=t;const i=r.items.enumextra.length,a=t.length;if(a>i)for(let e=i,o=a;e<o;e++)r.items.enumextra.push("选项"+t(e))}else{r=e(o["empty-array"]);const i=h(t[0]);r.items.properties=i.properties}return r}(t):function(t){let r="";if(u(t))r=e(o.boolean);else if(d(t))r=e(o.number);else if(s(t))r=e(o.url);else if(c(t))r=e(o.date);else if(f(t))r=e(o["date-time"]);else if(y(t))r=e(o.time);else if(x(t))r=e(o.color);else try{r=d(JSON.parse(t))?e(o.input):e(o.json)}catch(i){r=t&&t.length>30?e(o.textarea):e(o.input)}return r}(t),r}function q(e){let t=e&&e.format;return t||(t=e&&e.type?e.type:"input"),t}function R(e,t){let r=t||{};if(O(e)&&"object"===e.type&&e.properties){let t=[];t=e.propertyOrder?e.propertyOrder:Object.keys(e.properties),t.map(t=>{const i=e.properties[t];r=S(i,r)})}return r}function S(e,t){const r=!t;let i=t||{};if(e&&"{}"!==JSON.stringify(e)){const t=q(e);"object"===t||"func"===t||"style"===t||"data"===t?(!r&&i.object?i.object+=1:r||(i.object=1),i=R(e,i)):"array"===t?(!r&&i.array?i.array+=1:r||(i.array=1),i=R(e=e.items,i)):!r&&i[t]?i[t]+=1:r||(i[t]=1)}return i}function v(e,r){let i="",a=r;t(a)&&t(e.default)&&typeof a!=typeof e.default&&(a=void 0);let o=t(a)?a:e.default;switch(e.type){case"string":if("typeSelect"===e.format)i=e.default;else if("color"===e.format)"#fff"!==o&&"#FFF"!==o||(o="#ffffff"),i=o||"#ffffff";else if("json"===e.format){let e="";if(O(r)||m(r))e=r;else if(j(r)||""===r)e={};else try{e=JSON.parse(r)}catch(t){e={}}i=e}else i=t(o)?o:"";break;case"boolean":i=!!t(o)&&o;break;case"number":i=t(o)?o:1;break;default:i=t(o)?o:""}return i}function N(r,i){let o={};const n=q(r);if(O(r)&&"object"===r.type){const p=r;let s=i;t(s)&&t(p.default)&&typeof s!=typeof p.default&&(s=void 0);const l=t(s)?s:p.default;if("dynamic-data"===n)o=e(a),l&&O(l)&&"{}"!==JSON.stringify(l)&&(o=Object.assign(o,l));else if("datasource"===n)p.properties&&p.properties.type&&p.properties.type.default&&"local"===p.properties.type.default?(o={data:"{}",filter:"() => {}"},l&&l.data&&(o.data=l.data),l&&l.filter&&(o.filter=l.filter),"http://xxx"===o.data&&(o.data="{}")):(o={data:"http://xxx",filter:"() => {}"},l&&l.data&&(o.data=l.data),l&&l.filter&&(o.filter=l.filter),"{}"===o.data&&(o.data="http://xxx"));else if("event"===n)p.properties&&p.properties.type&&p.properties.type.default&&"emit"===p.properties.type.default?l&&"out"===l.type?o={trigger:l&&l.filter||"eventName",eventData:"{}"}:(o={trigger:"eventName",eventData:"{}"},l&&l.trigger&&(o.trigger=l.trigger),l&&l.eventData&&(o.eventData=l.eventData)):l&&"in"===l.type?o={register:"eventName",actionFunc:l&&l.filter||"() => {}"}:(o={register:"eventName",actionFunc:"() => {}"},l&&l.register&&(o.register=l.register),l&&l.actionFunc&&(o.actionFunc=l.actionFunc));else if(r.properties){let e=[];e=r.propertyOrder?r.propertyOrder:Object.keys(r.properties),e.map(e=>{const t=r.properties[e],a=i&&i[e];switch(t.type){case"array":o[e]=D(t,a);break;case"object":o[e]=N(t,a);break;default:o[e]=v(t,a)}})}}return o}function D(e,r){let i=[];if(e&&"array"===e.type){let a=r;t(a)&&t(e.default)&&typeof a!=typeof e.default&&(a=void 0);const o=t(a)?a:e.default;if("array"===e.format)if(m(o))o.map(t=>{i.push(N(e.items,t))});else{const t=N(e.items,o);i.push(t)}else i=t(o)?o:[]}return i}const F=o;exports.DataSourceTypeList=p,exports.EventTypeDataList=n,exports.KeyWordList=["key","enum","enumextra","items","input","boolean","number","color","url","textarea","radio","select","date","date-time","time","json","codearea","htmlarea","quantity","dynamic-data","datasource","event","array","object"],exports.TypeDataList=o,exports.dataRoute2dataPath=function(e,t){let r=t||"data";return e.split("-").map(e=>{r=/^\d+$/.test(e)?`${r}[${e}]`:`${r}.${e}`}),r},exports.dynamicDataAnalyzer=function e(t,r){let i=r||[];if(t&&"{}"!==JSON.stringify(t))if(O(t))if(t.type&&"remote"===t.type&&t.config&&O(t.config)&&t.localFilter&&t.data){let e=t.config.body;if(e&&!O(e))try{e=JSON.parse(e)}catch(t){e={}}i.push({id:t.config.id,dataName:t.config.dataName,body:e})}else{Object.keys(t).map(r=>{e(t[r],i)})}else m(t)&&t.map(t=>{e(t,i)});return i},exports.exitPropertie=t,exports.getCurPosition=function(e,t){const r=e.split("-"),i=t.split("-");let a="before";for(let e=0,t=(r.length>i.length?i:r).length;e<t;e+=1){Number(r[e])>Number(i[e])&&(a="after")}return a},exports.getCurrentFormat=q,exports.getJsonDataByKeyRoute=function(t,r,i){let a=r;if(i&&(a=e(r)),t){const e=t.split("-");for(let t=0,r=e.length;t<r;t++){const r=e[t];r&&(a=a&&a[r])}}return a},exports.getNextIndexRoute=function(e){const t=e.split("-"),r=t.pop(),i=Number(r)+1;return t.push(""+i),t.join("-")},exports.getParentIndexRoute=function(e){const t=e.split("-");return t.pop(),t.join("-")},exports.getParentIndexRoute_CurIndex=function(e){const t=e.split("-"),r=t.pop();return[t.join("-"),r]},exports.getParentKeyRoute=function(e){const t=e.split("-");return t.pop(),t.join("-")},exports.getParentKeyRoute_CurKey=function(e){const t=e.split("-"),r=t.pop();return[t.join("-"),r]},exports.getSchemaByIndexRoute=function(t,r,i){let a=r;if(i&&(a=e(r)),t){const e=t.split("-");for(let t=0,r=e.length;t<r;t++){const r=e[t];if("0"!==r||"array"!==a.format&&"radio"!==a.format&&"select"!==a.format||!a.items){if(r){let e="0";if(a.propertyOrder)e=a.propertyOrder[r];else if(a.properties){e=Object.keys(a.properties)[r]}a=a.properties[e]}}else a=a.items}}return a},exports.indexRoute2keyRoute=function(e,t){let r=t,i="";const a=e.split("-");for(let e=0,t=a.length;e<t;e++){const t=a[e];if("0"===t&&r.items)r=r.items,i=i?i+"-items":"items";else if(t){let e="0";if(r.propertyOrder)e=r.propertyOrder[t];else if(r.properties){e=Object.keys(r.properties)[t]}r=r.properties[e],i=i?`${i}-${e}`:e}}return i},exports.isArray=m,exports.isBoolean=u,exports.isBoxSchemaData=function(e){let t=!1;return"func"!==e&&"style"!==e&&"data"!==e&&"object"!==e||(t=!0),t},exports.isColor=x,exports.isDateStr=c,exports.isDateTimeStr=f,exports.isEmptySchema=function(e){let t=!0;if(!e)return t;const r=q(e);return("object"===r&&e.properties&&e.propertyOrder&&e.propertyOrder.length>0||"array"===r&&e.items&&e.items.properties&&e.items.propertyOrder&&e.items.propertyOrder.length>0||e.type||e.format)&&(t=!1),t},exports.isEmptyWidgetSchema=function(e){let t=!0;if(e){if("object"===q(e)&&e.properties&&e.propertyOrder&&e.propertyOrder.length>0){const r=e.properties.func||{},i=e.properties.style||{},a=e.properties.data||{};(r.propertyOrder&&r.propertyOrder.length>0||i.propertyOrder&&i.propertyOrder.length>0||a.propertyOrder&&a.propertyOrder.length>0)&&(t=!1)}}return t},exports.isEqual=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},exports.isFirstSchemaData=function(e){let t=!1;return"func"!==e&&"style"!==e&&"data"!==e||(t=!0),t},exports.isFunction=j,exports.isNewSchemaData=function(e){let t=!1;const{lastUpdateTime:r}=e,i=new Date("2020-07-29T07:30:00.691Z").getTime();return r&&new Date(r).getTime()>=i&&(t=!0),t},exports.isNumber=d,exports.isObject=O,exports.isQuantity=b,exports.isSameParent=function(e,t){const r=e.split("-"),i=t.split("-");return r.pop(),i.pop(),r.join("-")===i.join("-")},exports.isSelect=g,exports.isString=l,exports.isTimeStr=y,exports.isURL=s,exports.isUsedToWidgetConfig=function(e){let t=!1;if(e){"object"===q(e)&&e.properties&&e.propertyOrder&&e.properties.func&&e.properties.style&&e.properties.data&&(t=!0)}return t},exports.json2schema=h,exports.json2treeData=function e(t,r){let i=[];if(O(t)){Object.keys(t).map(a=>{const o=t[a],n=r?`${r}-${a}`:a;O(o)||m(o)?i.push({title:a,value:n,key:n,children:e(o,n)}):i.push({title:a,value:n,key:n})})}else m(t)&&t.map((t,a)=>{const o=r?`${r}-${a}`:a;O(t)||m(t)?i.push({title:a,value:o,key:o,children:e(t,o)}):i.push({title:a,value:o,key:o})});return i},exports.metaElemAnalyzer=S,exports.moveBackward=function(e){const t=e.split("-"),r=t.pop();return t.push(Number(r)+1),t.join("-")},exports.moveForward=function(e){const t=e.split("-"),r=t.pop();return t.push(Number(r)-1),t.join("-")},exports.objClone=e,exports.oldSchemaToNewSchema=function r(i){let a=e(i);if(!a.title&&a.description&&(a.title=a.description),a.format||(a.format=q(a)),"quantity"!==a.format&&"array"!==a.format&&"datasource"!==a.format&&"event"!==a.format&&"object"!==a.format&&"radio"!==a.format&&"select"!==a.format||!t(a.default)||delete a.default,"radio"===a.format&&(a.type="string",a.enum&&a.enumextra&&(a.items={type:"string",enum:e(a.enum),enumextra:e(a.enumextra)},delete a.enum,delete a.enumextra)),"quantity"===a.format){const t=a.properties,r=e(o.quantity);if(t.quantity&&O(t.quantity)&&t.quantity.default){const e=t.quantity.default;r.properties.quantity.default="percent"===e?"%":e}a=r}if("datasource"===a.format){const t=a.properties,r=t.type&&t.type.default,i=t.data&&t.data.default,o=t.filter&&t.filter.default;"local"===r?(a=e(p.local),a.properties.data.default=i?e(i):"{}"):(a=e(p.remote),a.properties.data.default=i?e(i):"http://xxx"),a.properties.filter.default=o?e(o):"() => {}"}if("event"===a.format){const t=a.properties,r=t.type&&t.type.default;if("in"===r||"on"===r){const r=t.filter&&t.filter.default||"() => {}";a=e(n.on),t.actionFunc&&O(t.actionFunc)&&(a.properties.actionFunc.default=t.actionFunc.default||e(r))}else{const r=t.filter&&t.filter.default||"{}";a=e(n.emit),t.eventData&&O(t.eventData)&&(a.properties.eventData.default=t.eventData.default||e(r))}}return a.properties&&(a.required=Object.keys(a.properties),a.propertyOrder||(a.propertyOrder=a.required),a.propertyOrder.map(e=>{a.properties[e]=r(a.properties[e])})),a.items&&(a.items=r(a.items)),a},exports.schema2json=function(e,t){let r={};return r="object"===e.type?N(e,t):"array"===e.type?D(e,t):v(e,t),r},exports.schemaMetaList=F;
